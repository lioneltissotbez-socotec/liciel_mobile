<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <title>LICIEL â€“ Saisie terrain</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#2563eb">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="LICIEL Mobile">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="description" content="Application terrain pour diagnostics immobiliers SOCOTEC">

  <!-- Styles globaux -->
  <link rel="stylesheet" href="style.css">

  <!-- Styles modules -->
  <link rel="stylesheet" href="modules/pieces/pieces.css">
  <link rel="stylesheet" href="modules/photos/photos.css">
  <link rel="stylesheet" href="modules/description/description.css">

</head>

<body>

<header id="app-header">
  <span id="header-title">DÃ©marrage mission</span>
</header>

<main>

  <!-- Ã‰cran dÃ©marrage -->
  <section class="screen active" id="screen-start">
    <h2>Nouvelle mission</h2>

    <label>NumÃ©ro de dossier</label>
    <input id="input-dossier" placeholder="Ex : 2512CGEDI" autocomplete="off">

    <button class="primary" onclick="startMission()">DÃ©marrer la mission</button>

    <h3>Missions existantes</h3>
    <div id="missions-list"></div>
    
    <button class="secondary" onclick="openArchiveManager()" style="margin-top: 20px;">
      âš™ï¸ Gestion des donnÃ©es
    </button>
  </section>

  <!-- Ã‰cran piÃ¨ces -->
  <section class="screen" id="screen-pieces"></section>

  <!-- Ã‰cran description de piÃ¨ce -->
<section class="screen" id="screen-description"></section>

  <!-- Ã‰cran photos -->
  <section class="screen" id="screen-photos"></section>

</main>

<footer id="app-footer">
  <button onclick="go('start')">ğŸ </button>
  <button onclick="go('pieces')">ğŸšª</button>
  <button onclick="go('photos')">ğŸ“·</button>
</footer>

<!-- Core -->


<script src="core/store.js"></script>
<script src="core/db.js"></script>
<script src="core/migrations.js"></script>
<script src="core/photo-compressor.js"></script>
<script src="core/archive-manager.js"></script>

<!-- ZIP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

<!-- EXPORT -->
<script src="modules/export/export.utils.js"></script>
<script src="modules/export/export.pieces.js"></script>
<script src="modules/export/export.photos.js"></script>
<script src="modules/export/export.description.js"></script>
<script src="modules/export/export.zip.js"></script>

<!-- Modules -->
<script src="modules/pieces/pieces.model.js"></script>
<script src="modules/pieces/pieces.ui.js"></script>

<script src="modules/description/description.ui.js"></script>

<script src="modules/photos/photos.ui.js"></script>

<!-- Dictionnaires -->
<script src="core/dictionnaires.js"></script>
<script src="core/dictionnaires_description.js"></script>

<script src="core/plomb.rules.js"></script>

<!-- App (TOUJOURS EN DERNIER) -->
<script src="app.js"></script>

<!-- Service Worker Registration -->
<script>
  // Enregistrement du Service Worker pour PWA
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js')
        .then((registration) => {
          console.log('âœ… Service Worker enregistrÃ©:', registration.scope);
          
          // VÃ©rifier les mises Ã  jour
          registration.addEventListener('updatefound', () => {
            const newWorker = registration.installing;
            console.log('ğŸ”„ Mise Ã  jour du Service Worker dÃ©tectÃ©e');
            
            newWorker.addEventListener('statechange', () => {
              if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                // Nouvelle version disponible
                console.log('âœ¨ Nouvelle version disponible');
                
                // Optionnel : Afficher une notification Ã  l'utilisateur
                if (confirm('Une nouvelle version est disponible. Recharger maintenant ?')) {
                  newWorker.postMessage({ type: 'SKIP_WAITING' });
                  window.location.reload();
                }
              }
            });
          });
        })
        .catch((error) => {
          console.error('âŒ Erreur Service Worker:', error);
        });
    });
    
    // Recharger quand le nouveau SW prend le contrÃ´le
    let refreshing = false;
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      if (!refreshing) {
        refreshing = true;
        window.location.reload();
      }
    });
  }
</script>


</body>
</html>
